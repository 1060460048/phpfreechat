/**
 * phpfreechat's JQuery plugin
 * http://www.phpfreechat.net
 */var phpFreeChat=function(e,t,n,r){function u(n,r){this.element=n,this.options=t.extend({},o,r),this._defaults=o,this._name=i,e.init(this)}var i="phpfreechat",s=n.document,o={serverUrl:"../server",loaded:null,loadTestData:!1,refresh_delay:5e3};return t.fn[i]=function(e){return this.each(function(){t.data(this,"plugin_"+i)||t.data(this,"plugin_"+i,new u(this,e))})},e}(phpFreeChat||{},jQuery,window),phpFreeChat=function(e,t,n,r){return e.login=function(n,r){var i=n?{"Pfc-Authorization":"Basic "+e.base64.encode(n.login+":"+n.password)}:{},s=n?{email:n.email}:null;t.ajax({type:"GET",url:e.options.serverUrl+"/auth",headers:i,data:s}).done(function(n){t(e.element).trigger("pfc-login",[e,n]),r?r(null,n):null}).error(function(t){e.showAuthForm(n?t.statusText:null),r?r(t):null})},e.logout=function(n){t.ajax({type:"DELETE",url:e.options.serverUrl+"/auth"}).done(function(r){t(e.element).trigger("pfc-logout",[e,r]),n?n(null,r):null}).error(function(e){n?n(e):null})},e.showAuthForm=function(n){e.modalbox.open('<form>  <input type="text" name="login" placeholder="Login"/><br/>  <input type="text" name="email" placeholder="Email"/><br/>  <input type="submit" name="submit" value="Sign in" />'+(n?"<p>"+n+"</p>":"")+"</form>").submit(function(){var n=t(this).find("[name=login]").attr("value"),r=t(this).find("[name=password]").attr("value"),i=t(this).find("[name=email]").attr("value");return n?(e.login({login:n,password:r,email:i}),e.modalbox.close(!0),!1):!1}).find("[name=login]").focus()},e}(phpFreeChat||{},jQuery,window),phpFreeChat=function(e,t,n,r){return e.readPendingMessages=function(n){t.ajax({type:"GET",url:e.options.serverUrl+"/users/"+e.uid+"/msg/"}).done(function(t){t.forEach(function(t,n){e.appendMessage(t)}),n&&setTimeout(e.readPendingMessages,e.options.refresh_delay)}).error(function(t){console.log(t),n&&setTimeout(e.readPendingMessages,e.options.refresh_delay)})},e.join=function(n){t.ajax({type:"POST",url:e.options.serverUrl+"/channels/"+n+"/users/"}).done(function(t){e.clearUserList(),Object.keys(t).forEach(function(n){e.users[n]=t[n],e.appendUser(t[n])}),e.readPendingMessages(!0)}).error(function(e){console.log(e)})},e.postToChannel=function(n,r){t.ajax({type:"POST",url:e.options.serverUrl+"/channels/"+n+"/msg/",data:{message:r}}).done(function(t){e.appendMessage(t)}).error(function(e){console.log(e)})},e.appendUser=function(n){n.id=n.id!=r?n.id:0,n.role=n.role!=r?n.role:"user",n.name=n.name!=r?n.name:"Guest "+Math.round(Math.random()*100),n.email=n.email!=r?n.email:"",n.active=n.active!=r?n.active:!0;var i=t(e.element).find(n.role=="admin"?"div.pfc-role-admin":"div.pfc-role-user"),s=t('              <li class="user">                <div class="status"></div>                <div class="name"></div>                <div class="avatar"></div>              </li>');n.name&&s.find("div.name").text(n.name),i.find("li").length==0&&s.addClass("first"),s.find("div.status").addClass(n.active?"st-active":"st-inactive");var o=[];t(e.element).find("div.pfc-users li.user").each(function(e,n){o.push(parseInt(t(n).attr("id").split("_")[1]))});if(n.id==0)do n.id=Math.round(Math.random()*1e4);while(o.indexOf(n.id)!=-1);return n.id==0||o.indexOf(n.id)!=-1?(delete s,0):(s.attr("id","user_"+n.id),i.find("ul").append(s),e.updateRolesTitles(),n.id)},e.removeUser=function(n){var r=t(e.element).find("#user_"+n).remove().length>0;return e.updateRolesTitles(),r},e.updateRolesTitles=function(){return},e.clearUserList=function(){return t(e.element).find("li.user").remove(),e.updateRolesTitles(),!0},e.appendMessage=function(n){n.name=e.users[n.sender]!=r?e.users[n.sender].name:"???",n.message=n.message!=r?n.message:"",n.timestamp=n.timestamp!=r?n.timestamp:Math.round((new Date).getTime()/1e3),n.date=(new Date(n.timestamp*1e3)).toLocaleTimeString();var i=groupmsg_dom=t(e.element).find(".pfc-messages .messages-group:last"),s=t(e.element).find(".pfc-messages");if(groupmsg_dom.attr("data-from")!=n.name){var o=t('<div class="messages-group" data-stamp="" data-from="">            <div class="date"></div>            <div class="name"></div>          </div>');o.find(".name").text(n.name),o.attr("data-from",n.name),o.find(".date").text(n.date),o.attr("data-stamp",n.timestamp),s.append(o),groupmsg_dom=o}n.message=t("<pre></pre>").text(n.message).html();var u=t('<div class="message"></div>').html(n.message);groupmsg_dom.append(u);var a=0;return i.length==0?a=groupmsg_dom.outerHeight():a=groupmsg_dom.outerHeight()+i.data("scroll-pos"),s.animate({scrollTop:a}),groupmsg_dom.data("scroll-pos",a),u},e}(phpFreeChat||{},jQuery,window),phpFreeChat=function(e,t,n,r){return e.init=function(n){e.element=n.element,e.options=n.options,e.users={},e.channels={},e.uid=null,e.cid=null;if(!e.hasBacklink())return;e.loadHTML(),e.login(),t(e.element).bind("pfc-login",function(e,t,n){t.uid=n.id,t.users[n.id]=n,t.cid="xxx",t.join(t.cid)}),t(e.element).bind("pfc-logout",function(e,t,n){t.uid=null,t.clearUserList()})},e.hello=function(){return console.log("hello "+this.p._name),this},e.hasBacklink=function(){var n=t('a[href="http://www.phpfreechat.net"]').length;return n?!0:(t(e.element).html('<div class="pfc-backlink"><p>Please insert the phpfreechat backlink somewhere in your HTML in order to load the chat. The attended backlink is:</p><pre>'+t("<div/>").text('<a href="http://www.phpfreechat.net">phpFreeChat: simple Web chat</a>').html()+"</pre>"+"</div>"),!1)},e.loadHTML=function(){t(e.element).html('      <div class="pfc-content">        <div class="pfc-tabs">          <ul>            <li class="channel active">              <div class="icon"></div>              <div class="name">Default channel</div>              <div class="close"></div>            </li>'+(e.options.loadTestData?'            <li class="channel active">              <div class="icon"></div>              <div class="name">Channel 1</div>              <div class="close"></div>            </li>            <li class="channel">              <div class="icon"></div>              <div class="name">Channel 2</div>              <div class="close"></div>            </li>            <li class="pm">              <div class="icon"></div>              <div class="name">admin</div>              <div class="close"></div>            </li>':"")+'            <li class="new-tab">'+'              <div class="icon"></div>'+"            </li>"+"          </ul>"+"        </div>"+""+'        <div class="pfc-topic">'+'          <p><span class="pfc-topic-label">Topic:</span> <span class="pfc-topic-value">no topic for this channel</span></p>'+"        </div>"+""+'        <div class="pfc-messages">'+(e.options.loadTestData?'          <div class="messages-group" data-stamp="1336815502" data-from="kerphi">            <div class="avatar"><img src="http://www.gravatar.com/avatar/ae5979732c49cae7b741294a1d3a8682?d=wavatar&s=30" alt="" /></div>            <div class="date">11:38:21</div>            <div class="name">kerphi</div>            <div class="message">123</div>            <div class="message">456</div>          </div>          <div class="messages-group" data-stamp="1336815503" data-from="admin">            <div class="avatar"><img src="http://www.gravatar.com/avatar/00000000000000000000000000000001?d=wavatar&s=30" alt="" /></div>            <div class="date">11:38:22</div>            <div class="name">admin</div>            <div class="message">Hello</div>            <div class="message">World</div>            <div class="message">!</div>          </div>':"")+"        </div>"+""+'        <div class="pfc-users">'+'          <div class="pfc-role-admin">'+'            <p class="role-title">Administrators</p>'+"            <ul>"+(e.options.loadTestData?'              <li class="first">                <div class="status st-active"></div>                <div class="name">admin</div>                <div class="avatar"><img src="http://www.gravatar.com/avatar/00000000000000000000000000000001?d=wavatar&s=20" alt="" /></div>              </li>':"")+"            </ul>"+"          </div>"+'          <div class="pfc-role-user">'+'            <p class="role-title">Users</p>'+"            <ul>"+(e.options.loadTestData?'              <li class="first">                <div class="status st-active"></div>                <div class="name myself">kerphi</div>                <div class="avatar"><img src="http://www.gravatar.com/avatar/ae5979732c49cae7b741294a1d3a8682?d=wavatar&s=20" alt="" /></div>              </li>              <li>                <div class="status st-inactive"></div>                <div class="name">St√©phane Gully</div>                <div class="avatar"><img src="http://www.gravatar.com/avatar/00000000000000000000000000000002?d=wavatar&s=20" alt="" /></div>              </li>':"")+"            </ul>"+"          </div>"+"        </div>"+""+'        <div class="pfc-footer">'+'          <p class="logo"><a href="http://www.phpfreechat.net">Powered by phpFreeChat</a></p>'+"          <ul>"+"          </ul>"+"        </div>"+""+'        <div class="pfc-compose">'+'          <textarea data-to="channel|xxx"></textarea>'+"        </div>"+""+'        <div class="pfc-modal-overlay"></div>'+'        <div class="pfc-modal-box"></div>'+"      </div>"),t(".pfc-compose textarea").keydown(function(n){if(n.keyCode==13&&n.shiftKey==0)return e.postToChannel(e.cid,t(".pfc-compose textarea").val()),t(".pfc-compose textarea").val(""),!1}),e.modalbox.init(),e.options.loaded&&e.options.loaded(e),setTimeout(function(){t(e.element).trigger("pfc-loaded",[e])},0)},e}(phpFreeChat||{},jQuery,window),phpFreeChat=function(e,t,n,r){return jQuery=t,e.md5=function(t){function n(e,t){return e<<t|e>>>32-t}function r(e,t){var n,r,i,s,o;return i=e&2147483648,s=t&2147483648,n=e&1073741824,r=t&1073741824,o=(e&1073741823)+(t&1073741823),n&r?o^2147483648^i^s:n|r?o&1073741824?o^3221225472^i^s:o^1073741824^i^s:o^i^s}function i(e,t,n){return e&t|~e&n}function s(e,t,n){return e&n|t&~n}function o(e,t,n){return e^t^n}function u(e,t,n){return t^(e|~n)}function a(e,t,s,o,u,a,f){return e=r(e,r(r(i(t,s,o),u),f)),r(n(e,a),t)}function f(e,t,i,o,u,a,f){return e=r(e,r(r(s(t,i,o),u),f)),r(n(e,a),t)}function l(e,t,i,s,u,a,f){return e=r(e,r(r(o(t,i,s),u),f)),r(n(e,a),t)}function c(e,t,i,s,o,a,f){return e=r(e,r(r(u(t,i,s),o),f)),r(n(e,a),t)}function h(e){var t,n=e.length,r=n+8,i=(r-r%64)/64,s=(i+1)*16,o=Array(s-1),u=0,a=0;while(a<n)t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|e.charCodeAt(a)<<u,a++;return t=(a-a%4)/4,u=a%4*8,o[t]=o[t]|128<<u,o[s-2]=n<<3,o[s-1]=n>>>29,o}function p(e){var t="",n="",r,i;for(i=0;i<=3;i++)r=e>>>i*8&255,n="0"+r.toString(16),t+=n.substr(n.length-2,2);return t}function d(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(r&63|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(r&63|128))}return t}var v=Array(),m,g,y,b,w,E,S,x,T,N=7,C=12,k=17,L=22,A=5,O=9,M=14,_=20,D=4,P=11,H=16,B=23,j=6,F=10,I=15,q=21;t=d(t),v=h(t),E=1732584193,S=4023233417,x=2562383102,T=271733878;for(m=0;m<v.length;m+=16)g=E,y=S,b=x,w=T,E=a(E,S,x,T,v[m+0],N,3614090360),T=a(T,E,S,x,v[m+1],C,3905402710),x=a(x,T,E,S,v[m+2],k,606105819),S=a(S,x,T,E,v[m+3],L,3250441966),E=a(E,S,x,T,v[m+4],N,4118548399),T=a(T,E,S,x,v[m+5],C,1200080426),x=a(x,T,E,S,v[m+6],k,2821735955),S=a(S,x,T,E,v[m+7],L,4249261313),E=a(E,S,x,T,v[m+8],N,1770035416),T=a(T,E,S,x,v[m+9],C,2336552879),x=a(x,T,E,S,v[m+10],k,4294925233),S=a(S,x,T,E,v[m+11],L,2304563134),E=a(E,S,x,T,v[m+12],N,1804603682),T=a(T,E,S,x,v[m+13],C,4254626195),x=a(x,T,E,S,v[m+14],k,2792965006),S=a(S,x,T,E,v[m+15],L,1236535329),E=f(E,S,x,T,v[m+1],A,4129170786),T=f(T,E,S,x,v[m+6],O,3225465664),x=f(x,T,E,S,v[m+11],M,643717713),S=f(S,x,T,E,v[m+0],_,3921069994),E=f(E,S,x,T,v[m+5],A,3593408605),T=f(T,E,S,x,v[m+10],O,38016083),x=f(x,T,E,S,v[m+15],M,3634488961),S=f(S,x,T,E,v[m+4],_,3889429448),E=f(E,S,x,T,v[m+9],A,568446438),T=f(T,E,S,x,v[m+14],O,3275163606),x=f(x,T,E,S,v[m+3],M,4107603335),S=f(S,x,T,E,v[m+8],_,1163531501),E=f(E,S,x,T,v[m+13],A,2850285829),T=f(T,E,S,x,v[m+2],O,4243563512),x=f(x,T,E,S,v[m+7],M,1735328473),S=f(S,x,T,E,v[m+12],_,2368359562),E=l(E,S,x,T,v[m+5],D,4294588738),T=l(T,E,S,x,v[m+8],P,2272392833),x=l(x,T,E,S,v[m+11],H,1839030562),S=l(S,x,T,E,v[m+14],B,4259657740),E=l(E,S,x,T,v[m+1],D,2763975236),T=l(T,E,S,x,v[m+4],P,1272893353),x=l(x,T,E,S,v[m+7],H,4139469664),S=l(S,x,T,E,v[m+10],B,3200236656),E=l(E,S,x,T,v[m+13],D,681279174),T=l(T,E,S,x,v[m+0],P,3936430074),x=l(x,T,E,S,v[m+3],H,3572445317),S=l(S,x,T,E,v[m+6],B,76029189),E=l(E,S,x,T,v[m+9],D,3654602809),T=l(T,E,S,x,v[m+12],P,3873151461),x=l(x,T,E,S,v[m+15],H,530742520),S=l(S,x,T,E,v[m+2],B,3299628645),E=c(E,S,x,T,v[m+0],j,4096336452),T=c(T,E,S,x,v[m+7],F,1126891415),x=c(x,T,E,S,v[m+14],I,2878612391),S=c(S,x,T,E,v[m+5],q,4237533241),E=c(E,S,x,T,v[m+12],j,1700485571),T=c(T,E,S,x,v[m+3],F,2399980690),x=c(x,T,E,S,v[m+10],I,4293915773),S=c(S,x,T,E,v[m+1],q,2240044497),E=c(E,S,x,T,v[m+8],j,1873313359),T=c(T,E,S,x,v[m+15],F,4264355552),x=c(x,T,E,S,v[m+6],I,2734768916),S=c(S,x,T,E,v[m+13],q,1309151649),E=c(E,S,x,T,v[m+4],j,4149444226),T=c(T,E,S,x,v[m+11],F,3174756917),x=c(x,T,E,S,v[m+2],I,718787259),S=c(S,x,T,E,v[m+9],q,3951481745),E=r(E,g),S=r(S,y),x=r(x,b),T=r(T,w);var R=p(E)+p(S)+p(x)+p(T);return R.toLowerCase()},e.base64=jQuery.base64=function(e){function i(e,t){var r=n.indexOf(e.charAt(t));if(r===-1)throw"Cannot decode base64";return r}function s(e){var n=0,r,s,o=e.length,u=[];e=String(e);if(o===0)return e;if(o%4!==0)throw"Cannot decode base64";e.charAt(o-1)===t&&(n=1,e.charAt(o-2)===t&&(n=2),o-=4);for(r=0;r<o;r+=4)s=i(e,r)<<18|i(e,r+1)<<12|i(e,r+2)<<6|i(e,r+3),u.push(String.fromCharCode(s>>16,s>>8&255,s&255));switch(n){case 1:s=i(e,r)<<18|i(e,r+1)<<12|i(e,r+2)<<6,u.push(String.fromCharCode(s>>16,s>>8&255));break;case 2:s=i(e,r)<<18|i(e,r+1)<<12,u.push(String.fromCharCode(s>>16))}return u.join("")}function o(e,t){var n=e.charCodeAt(t);if(n>255)throw"INVALID_CHARACTER_ERR: DOM Exception 5";return n}function u(e){if(arguments.length!==1)throw"SyntaxError: exactly one argument required";e=String(e);var r,i,s=[],u=e.length-e.length%3;if(e.length===0)return e;for(r=0;r<u;r+=3)i=o(e,r)<<16|o(e,r+1)<<8|o(e,r+2),s.push(n.charAt(i>>18)),s.push(n.charAt(i>>12&63)),s.push(n.charAt(i>>6&63)),s.push(n.charAt(i&63));switch(e.length-u){case 1:i=o(e,r)<<16,s.push(n.charAt(i>>18)+n.charAt(i>>12&63)+t+t);break;case 2:i=o(e,r)<<16|o(e,r+1)<<8,s.push(n.charAt(i>>18)+n.charAt(i>>12&63)+n.charAt(i>>6&63)+t)}return s.join("")}var t="=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="1.0";return{decode:s,encode:u,VERSION:r}}(jQuery),e.modalbox={open:function(e){return e=t(e),t("div.pfc-modal-box *").remove(),t("div.pfc-modal-box").append(e).fadeIn(),t("div.pfc-modal-overlay").fadeIn("fast"),t(n).trigger("resize"),e},close:function(e){e?(t("div.pfc-modal-box").hide(),t("div.pfc-modal-overlay").hide()):(t("div.pfc-modal-box").fadeOut(),t("div.pfc-modal-overlay").fadeOut("fast"))},init:function(){t(n).resize(function(){var n=t("div.pfc-modal-box"),r=t("div.pfc-modal-overlay");n.css({left:(r.outerWidth(!0)-n.outerWidth(!0))/2,top:(r.outerHeight(!0)-n.outerHeight(!0))/2})}).trigger("resize")}},e}(phpFreeChat||{},jQuery,window);